{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

<<<<<<< HEAD
    <title>Student Dashboard - Padhal Mitra</title>
=======
    <title>Make Note - Padhal Mitra</title>
>>>>>>> b1453d1ee6062e07aadf3b410fe152aa1c1d2bbc
  </head>

  <body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="w-full bg-white border-b shadow-sm py-4">
      <div
        class="max-w-6xl mx-auto flex items-center justify-between px-4 sm:px-8"
      >
        <div class="flex items-center gap-3">
          <a href="{% url 'dashboard_student' %}">
            <img
              src="{% static 'images/logo.png' %}"
              alt="logo"
              class="w-20 h-20 object-contain"
            />
          </a>
        </div>
        <div class="text-center">
          <h1 class="text-xl sm:text-2xl font-bold text-gray-800">
            Make <span class="text-blue-800">Note</span>
          </h1>
        </div>
        <div
          class="w-10 h-10 sm:w-12 sm:h-12 rounded-full overflow-hidden border-2 border-blue-300 bg-gray-50 flex items-center justify-center shadow-sm"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 4.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6.75 17.25c0-2.625 2.25-4.875 5.25-4.875s5.25 2.25 5.25 4.875"
            />
          </svg>
        </div>
      </div>
    </header>

    <!-- Form Section -->
    <section class="w-full max-w-6xl mx-auto mt-10 px-4 sm:px-6">
      <h2 class="text-2xl font-bold text-gray-700 mb-6 text-center relative">
        <a
          href="{% url 'dashboard_student' %}"
          class="absolute left-0 text-md sm:text-base text-blue-700 hover:underline"
        >
          Back
        </a>
        Create a New Note
        <a
          title="Microphone"
          href="#"
          class="absolute top-0 right-0 text-white w-28 h-12 rounded-2xl shadow-2xl flex items-center justify-center border-4 border-white z-20 hover:opacity-90 transition"
          style="
            background: linear-gradient(to bottom, #003366 0%, #0066cc 100%);
          "
        >
          <i class="fas fa-microphone text-lg" alt="Microphone"></i>
        </a>
      </h2>

      <form method="post" class="bg-white p-6 rounded-xl shadow-md space-y-6">
        {% csrf_token %}

        <div>
          <label for="title" class="block text-sm font-medium text-gray-700"
            >Title</label
          >
          <input
            type="text"
            name="title"
            id="title"
            value="{{ form.title.value|default:'' }}"
            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"
            required
          />
        </div>

        <div>
          <label for="subject" class="block text-sm font-medium text-gray-700"
            >Subject</label
          >
          <input
            type="text"
            name="subject"
            id="subject"
            value="{{ form.subject.value|default:'' }}"
            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"
            required
          />
        </div>

        <div>
          <label for="content" class="block text-sm font-medium text-gray-700"
            >Note Content</label
          >
          <textarea
            name="content"
            id="content"
            rows="6"
            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"
            required
          >
{{ form.content.value|default:'' }}</textarea
          >
        </div>

        <div class="flex justify-center gap-3">
          <button
            class="bg-blue-900 hover:bg-blue-700 text-sm text-white font-semibold px-6 py-3 rounded-lg transition duration-300"
          >
            Read Out Loud
          </button>
          <button
            type="submit"
            class="bg-yellow-500 hover:bg-yellow-400 text-sm text-white font-semibold px-6 py-3 rounded-lg transition duration-300"
          >
            Save Note
          </button>
        </div>
      </form>
    </section>
<<<<<<< HEAD

    <script>
      let mediaRecorder;
      let audioChunks = [];
      let isRecording = false;
      
      document.addEventListener("keydown", async function (e) {
          if (e.code === "Space" && !isRecording) {
              try {
                  isRecording = true;
                  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                  mediaRecorder = new MediaRecorder(stream);
      
                  mediaRecorder.ondataavailable = (e) => {
                      audioChunks.push(e.data);
                  };
      
                  mediaRecorder.onstop = async () => {
                      const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                      const formData = new FormData();
                      formData.append('audio_file', audioBlob, 'recording.wav');
      
                      // Upload the audio file to the server
                      fetch('/save_note_audio/', {
                          method: 'POST',
                          headers: {
                              'X-CSRFToken': getCSRFToken() // Ensure CSRF protection
                          },
                          body: formData
                      })
                      .then(res => res.json())
                      .then(data => {
                          console.log("Upload response:", data);
      
                          // Check if the response contains a 'redirect' key
                          if (data.redirect) {
                              // If there's a redirect URL, navigate to it
                              window.location.href = data.redirect;
                          } else {
                              // Fallback to audio playback (if there's no redirect)
                              if (document.getElementById("audioPlayback")) {
                                  const audioUrl = URL.createObjectURL(audioBlob);
                                  document.getElementById("audioPlayback").src = audioUrl;
                              }
                          }
                      })
                      .catch(err => console.error("Upload error:", err));
      
                      audioChunks = [];
                  };
      
                  mediaRecorder.start();
                  console.log("Recording started...");
              } catch (err) {
                  console.error("Error accessing microphone:", err);
                  alert("Failed to access microphone. Please check permissions.");
              }
          }
      });
      
      document.addEventListener("keyup", function (e) {
          if (e.code === "Space" && isRecording) {
              mediaRecorder.stop();
              isRecording = false;
              console.log("Recording stopped.");
          }
      });
      
      // Helper to get CSRF token
      function getCSRFToken() {
          const cookies = document.cookie.split(';');
          for (let cookie of cookies) {
              if (cookie.trim().startsWith('csrftoken=')) {
                  return cookie.trim().substring('csrftoken='.length);
              }
          }
          return '';
      }
      </script> 
    
    
    
      

  
      
=======
>>>>>>> b1453d1ee6062e07aadf3b410fe152aa1c1d2bbc
  </body>
</html>
